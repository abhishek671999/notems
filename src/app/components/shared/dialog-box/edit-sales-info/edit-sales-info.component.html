<h3 style="text-align: center;">Edit sale</h3>
<div class="main-container">
    <form class="new-task-form" [formGroup]="editSalesForm">
        <mat-form-field>
            <mat-label>Select customer</mat-label>
            <mat-select formControlName="customer_id">
                <mat-option *ngFor="let customer of customerList; let i=index" [value]="customer.customer_id">{{customer.customer_name}}</mat-option>
            </mat-select>
        </mat-form-field>

        <div *ngIf="itemsAdded.length > 0">
          <table mat-table [dataSource]="itemsAdded">
            <ng-container matColumnDef="sl_no">
                <th mat-header-cell *matHeaderCellDef>Sl No.</th>
                <td mat-cell *matCellDef="let element; let i=index">{{i + 1}}</td>
              </ng-container>
            
              <ng-container matColumnDef="item_name">
                <th mat-header-cell *matHeaderCellDef>Name</th>
                <td mat-cell *matCellDef="let element">{{element.item_name}}</td>
              </ng-container>
              
              <ng-container matColumnDef="item_price">
                <th mat-header-cell *matHeaderCellDef>Price</th>
                <td mat-cell *matCellDef="let element">{{element.price}}</td>
              </ng-container>
    
              <ng-container matColumnDef="quantity">
                <th mat-header-cell *matHeaderCellDef>Quantity</th>
                <td mat-cell *matCellDef="let element">
                    <div class="quantity-section">
                        <b>{{element.quantity}}</b>
                    </div>
                </td>
              </ng-container>
              
              <ng-container matColumnDef="delete">
                <th mat-header-cell *matHeaderCellDef>Delete</th>
                <td mat-cell *matCellDef="let element">
                  <span (click)="deleteLineItem(element)" class="material-symbols-outlined">delete</span>
                </td>
              </ng-container>
    
              <tr mat-header-row *matHeaderRowDef="itemListColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: itemListColumns;"></tr>
        </table>
        </div>
        <div style="text-align: center;">
          <button (click)="editItems()"  mat-raised-button>Edit items</button>
        </div>
        <div>
          <h3>Total amount: {{editSalesForm.value.amount}}</h3>
        </div>

        <mat-form-field >
            <mat-label>Enter discount</mat-label>
            <input matInput placeholder="Discount" formControlName="discount">
        </mat-form-field>

        <mat-form-field >
            <mat-label>Enter received amount</mat-label>
            <input matInput placeholder="Received amount" formControlName="received_amount">
        </mat-form-field>

        <mat-form-field >
            <mat-label>Enter a note</mat-label>
            <input matInput placeholder="Note" formControlName="note">
        </mat-form-field>

        <div class="image-thumbnail" *ngFor="let image of saleData.image_details">
          <img src="{{image.image_url}}" alt="" width="100px" height="100px">
        </div>
        <div>
            <form class="upload-form">  
              <label
                for="file"
                (dragover)="handleDragOver($event)"
                (drop)="handleDrop($event)"
              >
                <i class="ph ph-upload"></i>
                <span>
                  Click here to upload item image
                </span>
              </label>
            
              <input
                id="file"
                type="file"
                name="file"
                (change)="onFileSelected($event)"
              />
            
              <div class="result" [style.display]="outputBoxVisible ? 'flex' : 'none'">
                <i class="ph ph-file"></i>
                <div class="file-details">
                  <span class="file-name">{{ fileName }}</span>
                  <ng-container *ngIf="uploadStatus === 200 || uploadStatus === undefined">
                    <span class="file-size">{{ fileSize }}</span>
                  </ng-container>
                </div>
            
                <div class="upload-result" [style.display]="uploadStatus ? 'flex' : 'none'">
                  <span>{{ uploadResult }}</span>
                  <ng-container *ngIf="uploadStatus === 200; else error">
                    <i class="ph ph-check-circle"></i>
                  </ng-container>
                  <ng-template #error>
                    <i class="ph ph-x-circle"></i>
                  </ng-template>
                </div>
              </div>
            </form>
        </div>     
    </form>
    <br>
    <div style="text-align: center;">
        <button  mat-flat-button [disabled]="!(editSalesForm.valid)" (click)="editSales()">Edit Sale</button>
        <mat-error style="font-size: x-small;" *ngIf="editSalesForm.hasError('incorrectDiscount')">Discount should be less than amount</mat-error>
        <mat-error style="font-size: x-small;" *ngIf="editSalesForm.hasError('incorrectReceivedAmount')">Received amount should be less than amount</mat-error>
    </div>

</div>
